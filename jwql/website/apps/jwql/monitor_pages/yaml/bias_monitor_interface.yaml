# YAML file defining bokeh figures for the bias monitor
# - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
# Bias v. Time Figure
# - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
- !ColumnDataSource: &bias_source
  ref: "bias_source"
  data:
    time: !self.timestamps
    bias: !self.bias

- !Range1d: &bias_xrange
  ref: "bias_xrange"
  #start: 0
  #end: 1
  #bounds: 'auto'  #!!python/tuple [0, 1]

- !Range1d: &bias_yrange
  ref: "bias_yrange"
  #start: 0
  #end: 1
  #bounds: !!python/tuple [-1, 1]

- !Figure: &bias_time_figure
  ref: "bias_time_figure"
  x_axis_label: "Time (MJD)"
  y_axis_label: "Bias (e-)"
  x_range: *bias_xrange
  y_range: *bias_yrange
  elements:
    - {'kind': 'circle', 'x': 'time', 'y': 'bias', line_width: 5, 'source': *bias_source}

# - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
# Bias Histogram Figure
# - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
- !ColumnDataSource: &bias_full_hist_source
  ref: "bias_full_hist_source"
  data:
    full_bias_bin_center: !self.full_bias_bin_center
    full_bias_amplitude: !self.full_bias_amplitude
    full_bias_bottom: !self.full_bias_bottom
    full_bias_bin_width: !self.full_bias_bin_width

- !Range1d: &bias_histogram_xrange
  ref: "bias_histogram_xrange"
  #start: 0
  #end: 1
  #bounds: 'auto'  #!!python/tuple [0, 1]

- !Range1d: &bias_histogram_yrange
  ref: "bias_histogram_yrange"
  #start: 0
  #end: 1
  #bounds: !!python/tuple [0, 1]

- !Figure: &bias_full_histogram_figure
  ref: "bias_full_histogram_figure"
  x_axis_label: "Bias (DN/sec)"
  y_axis_label: "Number of Pixels"
  x_range: *bias_histogram_xrange
  y_range: *bias_histogram_yrange
  elements:
    - {'kind': 'vbar', 'x': 'full_bias_bin_center', 'y': 'full_bias_bin_width', 'top': 'full_bias_amplitude', 'bottom': 'full_bias_bottom',  'source': *bias_full_hist_source}
#    - {'kind': 'text', 'x': 0, 'y': 20000, 'id': 1001}

# - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
# Mean Bias Image Figure
# - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
- !ColumnDataSource: &mean_bias_source
    ref: "mean_bias_source"
    data:
        dh: [1]
        dw: [1]
        image: [[[1,0], [0, 1]]]
- !Range1d: &stamp_xr
    ref: "stamp_xr"
    #start: 0
    #end: 1
    #bounds: !!python/tuple [0, 1]
- !Range1d: &stamp_yr
    ref: "stamp_yr"
    #start: 0
    #end: 1
    #bounds: !!python/tuple [0, 1]
- !LogColorMapper: &log_mapper
    ref: "log_mapper"
    palette: "Viridis256"
    low: 0.
    high: 1.
- !ColorBar: &mean_bias_cbar
    ref: "mean_bias_cbar"
    color_mapper: *log_mapper
    location: !!python/tuple [0, 0]
- !Figure: &mean_bias_image_figure
    ref: "mean_bias_image_figure"
    x_axis_label: "Col = SIAF det Y"
    y_axis_label: "Row = SIAF det X"
    x_range: *stamp_xr
    y_range: *stamp_yr
    tools: ""
    height: 250  # Not working
    width: 250  # Not working
    elements:
        - {"kind": "image", "image": "image", "x": 0, "y": 0, "dh": 'dh', "dw": 'dh', "source": *mean_bias_source, "color_mapper": *log_mapper}
        - {"kind": "layout", "obj": *mean_bias_cbar, "place": "right"}



